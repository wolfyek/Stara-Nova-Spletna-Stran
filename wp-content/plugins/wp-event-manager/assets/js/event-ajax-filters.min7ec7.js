var EventAjaxFilters = function () { var e, t = []; return { init: function () { Common.logInfo("EventAjaxFilters.init..."), jQuery(".wpem-search-event-more-filter").length > 0 && (jQuery(".wpem-event-advance-filter").hide(), jQuery(".wpem-search-event-more-filter").on("click", function () { jQuery(".wpem-event-advance-filter").slideToggle("slow") })), jQuery.isFunction(jQuery.fn.chosen) && (1 == event_manager_ajax_filters.is_rtl && (jQuery('select[name^="search_datetimes"]').addClass("chosen-rtl"), jQuery('select[name^="search_categories"]').addClass("chosen-rtl"), jQuery('select[name^="search_event_types"]').addClass("chosen-rtl"), jQuery('select[name^="search_ticket_prices"]').addClass("chosen-rtl")), jQuery('select[name^="search_datetimes"]').chosen({ search_contains: !0 }), jQuery('select[name^="search_categories"]').chosen({ search_contains: !0 }), jQuery('select[name^="search_event_types"]').chosen({ search_contains: !0 }), jQuery('select[name^="search_ticket_prices"]').chosen({ search_contains: !0 })), e = !(!window.history || !window.history.pushState), jQuery(document).ready(EventAjaxFilters.actions.windowLoad), jQuery(document.body).on("click", ".load_more_events", EventAjaxFilters.actions.loadMoreEvents), jQuery(".event_filters").on("click", ".reset", EventAjaxFilters.actions.eventAjaxFiltersReset), jQuery("div.event_listings").on("click", ".event-manager-pagination a", EventAjaxFilters.actions.eventPagination), jQuery(".event_listings").on("update_event_listings", EventAjaxFilters.actions.getEventListings), jQuery("#search_keywords, #search_location, #search_datetimes, #search_categories, #search_event_types, #search_ticket_prices, .event-manager-filter").change(function () { var e = jQuery(this).closest("div.event_listings"); e.triggerHandler("update_event_listings", [1, !1]), EventAjaxFilters.event_manager_store_state(e, 1) }).on("keyup", function (e) { 13 === e.which && jQuery(this).trigger("change") }) }, event_manager_store_state: function (t, n) { Common.logInfo("EventAjaxFilters.event_manager_store_state..."); var a = document.location.href.split("#")[0]; if (e) { var i = t.find(".event_filters"), r = jQuery(i).serialize(), s = jQuery("div.event_listings").index(t); window.history.replaceState({ id: "event_manager_state", page: n, data: r, index: s }, "", a + "#events") } }, actions: { windowLoad: function (e) { Common.logInfo("EventAjaxFilters.actions.windowLoad..."), jQuery(".event_filters").each(function () { var e = jQuery(this).closest("div.event_listings"), t = e.find(".event_filters"), n = 1, a = jQuery("div.event_listings").index(e); if (window.history.state && window.location.hash) { var i = window.history.state; i.id && "event_manager_state" === i.id && a == i.index && (n = 1, t.deserialize(i.data), t.find(':input[name^="search_datetimes"]').not(':input[type="hidden"]').trigger("chosen:updated"), t.find(':input[name^="search_categories"]').not(':input[type="hidden"]').trigger("chosen:updated"), t.find(':input[name^="search_event_types"]').not(':input[type="hidden"]').trigger("chosen:updated"), t.find(':input[name^="search_ticket_prices"]').not(':input[type="hidden"]').trigger("chosen:updated")) } e.triggerHandler("update_event_listings", [n, !1]) }) }, eventAjaxFiltersReset: function (e) { Common.logInfo("EventAjaxFilters.actions.eventAjaxFiltersReset..."); var t = jQuery(this).closest("div.event_listings"), n = jQuery(this).closest("form"); return n.find(':input[name="search_keywords"], :input[name="search_location"], .event-manager-filter').not(':input[type="hidden"]').val("").trigger("chosen:updated"), n.find(':input[name^="search_datetimes"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"), n.find(':input[name^="search_categories"]').not(':input[type="hidden"]').val("").trigger("chosen:updated"), n.find(':input[name^="search_event_types"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"), n.find(':input[name^="search_ticket_prices"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"), t.triggerHandler("reset"), t.triggerHandler("update_event_listings", [1, !1]), EventAjaxFilters.event_manager_store_state(t, 1), !1 }, loadMoreEvents: function (e) { Common.logInfo("EventAjaxFilters.actions.loadMoreEvents..."); var t = jQuery(this).closest("div.event_listings"), n = parseInt(jQuery(this).data("page") || 1); return jQuery(this).addClass("wpem-loading"), n += 1, jQuery(this).data("page", n), EventAjaxFilters.event_manager_store_state(t, n), t.triggerHandler("update_event_listings", [n, !0, !1]), !1 }, eventPagination: function (e) { Common.logInfo("EventAjaxFilters.actions.eventPagination..."); var t = jQuery(this).closest("div.event_listings"), n = jQuery(this).data("page"); return EventAjaxFilters.event_manager_store_state(t, n), t.triggerHandler("update_event_listings", [n, !1]), jQuery("body, html").animate({ scrollTop: t.offset().top }, 600), !1 }, getEventListings: function (e, n, a, i) { Common.logInfo("EventAjaxFilters.actions.getEventListings..."); var r = "", s = jQuery(this), o = s.find(".event_filters"), d = s.find(".showing_applied_filters"), l = s.find(".event_listings"), c = s.data("per_page"), _ = s.data("orderby"), g = s.data("order"), u = s.data("featured"), v = s.data("cancelled"), p = s.data("event_online"), h = jQuery("div.event_listings").index(this); if (!(h < 0)) { if (t[h] && t[h].abort(), a || (jQuery(l).addClass("wpem-loading"), jQuery("div.event_listing, div.no_event_listings_found", l).css("visibility", "hidden"), s.find(".load_more_events").data("page", n)), 1 == s.data("show_filters")) { var m = o.find(':input[name^="search_datetimes"]').map(function () { return jQuery(this).val() }).get(); jQuery("input.date_range_picker").length > 0 && jQuery("input.date_range_picker").daterangepicker(); var y = o.find(':input[name^="search_categories"]').map(function () { return jQuery(this).val() }).get(), j = o.find(':input[name^="search_event_types"]').map(function () { return jQuery(this).val() }).get(), f = o.find(':input[name^="search_ticket_prices"]').map(function () { return jQuery(this).val() }).get(), Q = "", w = "", x = o.find(':input[name="search_keywords"]'), E = o.find(':input[name="search_location"]'); if (x.val() !== x.attr("placeholder") && (Q = x.val()), E.val() !== E.attr("placeholder") && (w = E.val()), jQuery(':input[name="event_online"]').length > 0) if (1 == jQuery(':input[name="event_online"]').prop("checked")) p = "true"; else p = ""; r = { lang: event_manager_ajax_filters.lang, search_keywords: Q, search_location: w, search_datetimes: m, search_categories: y, search_event_types: j, search_ticket_prices: f, per_page: c, orderby: _, order: g, page: n, featured: u, cancelled: v, event_online: p, show_pagination: s.data("show_pagination"), form_data: o.serialize() } } else { Q = s.data("keywords"), w = s.data("location"), m = JSON.stringify(s.data("datetimes")), y = s.data("categories"), j = s.data("event_types"), f = s.data("ticket_prices"); y && (y = y.split(",")), j && (j = j.split(",")), r = { lang: event_manager_ajax_filters.lang, search_keywords: Q, search_location: w, search_datetimes: m, search_categories: y, search_event_types: j, search_ticket_prices: f, per_page: c, orderby: _, order: g, page: n, featured: u, cancelled: v, event_online: p, show_pagination: s.data("show_pagination") } } t[h] = jQuery.ajax({ type: "POST", url: event_manager_ajax_filters.ajax_url.toString().replace("%%endpoint%%", "get_listings"), data: r, success: function (e) { if (e) try { e.filter_value ? jQuery(d).show().html("<span>" + e.filter_value + "</span>" + e.showing_links) : jQuery(d).hide(), e.showing_applied_filters ? jQuery(d).addClass("showing-applied-filters") : jQuery(d).removeClass("showing-applied-filters"), e.html && (a && i ? (jQuery(l).prepend(e.html), jQuery("div.google-map-loadmore").length > 0 && jQuery("div .google-map-loadmore").not("div.google-map-loadmore:first").remove()) : a ? (jQuery(l).append(e.html), jQuery("div.google-map-loadmore").length > 0 && jQuery("div .google-map-loadmore").not("div.google-map-loadmore:first").remove()) : jQuery(l).html(e.html)), 1 == s.data("show_pagination") ? (s.find(".event-manager-pagination").remove(), e.pagination && s.append(e.pagination)) : (localStorage.setItem("total_event_page", e.max_num_pages), localStorage.setItem("current_event_page", n), !e.found_events || e.max_num_pages <= n ? jQuery(".load_more_events:not(.load_previous)", s).hide() : i || jQuery(".load_more_events", s).show(), jQuery(".load_more_events", s).removeClass("wpem-loading"), jQuery("li.event_listing", l).css("visibility", "visible")), jQuery(l).removeClass("wpem-loading"), s.triggerHandler("updated_results", e) } catch (e) { window.console && Common.logError(e) } }, error: function (e, t, n) { window.console && "abort" !== t && Common.logError(t + ": " + n) }, statusCode: { 404: function () { window.console && Common.logError("Error 404: Ajax Endpoint cannot be reached. Go to Settings > Permalinks and save to resolve.") } } }), e.preventDefault() } } } } }; EventAjaxFilters = EventAjaxFilters(), jQuery(document).ready(function (e) { EventAjaxFilters.init() });